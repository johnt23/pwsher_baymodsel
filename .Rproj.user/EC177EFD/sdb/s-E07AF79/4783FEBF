{
    "collab_server" : "",
    "contents" : "# model_run_mortality_effects.r\n# Created by John Trochta\n# Date started:  12/01/2016\n# Summary:\n# This script runs the Bayesian ASA model (BASA) for PWS using different\n# covariates and extracts the output. Each section calls run_models to perform\n# the following steps:\n#     1) Compiles and extracts each version of BASA from bin directory.\n#     2) Runs parallel processing where each covariate is individually turned on\n#        within BASA. Iterative reweighting of eff. sample sizes for age comps\n#        is done before running NUTS.\n#     3) Runs 3 MCMC chains with NUTS for each BASA-one covariate model.\n#        Importantly, parallel processsing is setup so that the max number of\n#        processors running at any time is n_cores x nuts.inputs$reps.\n#     4) Stores output files of each BASA model in their respective folders\n#        (following naming of hypothesis_names) and summary files of NUTS runs\n#        (i.e. parameter posterior quantiles & convergence diagnostics) within\n#        NUTS_chain_diagnostics\n\nlibrary(here)\nsetwd(here::here(\"src\"))\nlibrary(data.table)\nsource(file=\"run_models.R\")\n\n### Specifications for all model sets\nrun_year=\"2021\"\nrun_month=\"07\"\nhypothesis_names <- c(\"I. hoferi pre-2007 (Ages 5+)\",\n                      \"I. hoferi post-2007 (Ages 5+)\",\n                      \"VHSV (Ages 3-4)\",\n                      \"Summer upwelling (Ages 3+)\",\n                      \"Summer PDO (Ages 3+)\",\n                      \"Winter PDO (Ages 3+)\",\n                      'Summer NPGO (Ages 3+)',\n                      'Winter NPGO (Ages 3+)',\n                      'Total pink salmon returns (Ages 3+)',\n                      'GOA walleye pollock SSB (Ages 3+)',\n                      'GOA Pacific cod SB (Ages 3+)',\n                      'GOA Arrowtooth flounder total biomass (Ages 3+)',\n                      \"Summer humpback whale estimates (Age 3+)\",\n                      \"Humpback whale counts (Age 3+)\")\nh.block <- c(1:14) # Indices of above hypotheses in columns (matching length of this vector) of covariate matrix in PWS_ASA(covariate).ctl\nstart.years <- c(1994,2007,1994,rep(1980,9),1981,2006)\ninclude.null=FALSE\nn_run_types=length(hypothesis_names)\nn_age0_covs=8\nn_mor_covs=14\n\nn_cores <- 3\nmcmc.algorithm=\"NUTS\"\nnuts.inputs=data.frame(reps=3,iter=3000,adapt_delta=0.925,warm_up=500,nuts.mode=1)\n\n### Specifications for each model set\n\n##############################################\n# 2021_07_all fixed mortality effects\n# Run with\n#  - all mortality covariates as fixed effects from 1980-2017\n#  - rec devs are freely estimated (not centered or bias corrected)\n#  - mean mortality is fixed at 0.25 (line 461 in PWS_ASA.TPL)\n\nH.select <- list(single=4:13)\nn_models <- 1+length(H.select$single)\ncustom.settings <- list(n_run_types=n_run_types,\n                        R.or.M=rep('M',n_run_types),\n                        series_start_yr=2007, # This is the most recent start year of any time series\n                        estimate.1993.mortality=rep(1,n_models),\n                        estimate.mean.mortality=rep(0,n_models),\n                        mean.mortality=c(rep(0.25,length(hypothesis_names))),\n                        h.block=h.block,\n                        sim_cov=0,\n                        block.on=NULL,\n                        run_ID=paste0(run_year,'_',run_month,'_','all fixed mortality effects'),\n                        base.M=\"PWS_ASA_all fixed effects\")\n\nrun_models(hypothesis_names,\n           include.null,\n           start.years,\n           H.select,\n           n_cores,\n           n_sims,\n           n_age0_covs,\n           n_mor_covs,\n           custom.settings,\n           mcmc.algorithm,\n           nuts.inputs,\n           run_year,\n           run_month)\n# 2020-04-23:  277.6 mins.\n\n\n##############################################\n# 2021_07_all fixed mortality effects & start from 1994\n# Run with\n#  - all covariates as fixed effects\n#  - rec devs are freely estimated (not centered or bias corrected)\n#  - mean mortality is fixed at 0.25 (line 461 in PWS_ASA.TPL)\n\nH.select <- list(single=4:13,Disease=1:3)\nn_models <- 1+length(H.select$single)\ncustom.settings <- list(n_run_types=n_run_types,\n                        R.or.M=rep('M',n_run_types),\n                        series_start_yr=2007, # This is the most recent start year of any time series\n                        estimate.1993.mortality=rep(1,length(n_models)),\n                        estimate.mean.mortality=rep(0,length(n_models)),\n                        mean.mortality=c(rep(0.25,length(hypothesis_names))),\n                        h.block=h.block,\n                        sim_cov=0,\n                        block.on=NULL,\n                        run_ID=paste0(run_year,'_',run_month,'_','all fixed mortality effects & start from 1994'),\n                        base.M=\"PWS_ASA_all fixed effects _ start from 1994\")\n\nrun_models(hypothesis_names,\n           include.null,\n           start.years,\n           H.select,\n           n_cores,\n           n_sims,\n           n_age0_covs,\n           n_mor_covs,\n           custom.settings,\n           mcmc.algorithm,\n           nuts.inputs,\n           run_year,\n           run_month)\n# 2020-04-24:  200 mins.\n\n\n##############################################\n# 2021_07_latent mortality effects & year specific SE\n# Run with\n#  - select covariates are latent variables\n#  - rec devs are freely estimated (not centered or bias corrected)\n#  - mean mortality is fixed at 0.25 (line 461 in PWS_ASA.TPL)\n#  - Adapted from 2020_01_only latent mortality effects in years with obs, \n#  - CV of effects taken from assessment reports, not estimated\n\nH.select <- list(single=4:14,Disease=1:3)\nn_models <- 1+length(H.select$single)\n# H.select <- list(single=4:7)\ncustom.settings <- list(n_run_types=n_run_types,\n                        R.or.M=rep('M',n_run_types),\n                        series_start_yr=2007, # This is the most recent start year of any time series\n                        estimate.1993.mortality=c(rep(0,n_models-2),1,1),\n                        estimate.mean.mortality=rep(0,n_models),\n                        mean.mortality=rep(0.25,n_models),\n                        h.block=h.block,\n                        sim_cov=0,\n                        block.on=NULL,\n                        run_ID=paste0(run_year,'_',run_month,'_','latent mortality effects _ year specific SE'),\n                        base.M=\"PWS_ASA_latent vars for mortality _ year specific SE\")\n\nrun_models(hypothesis_names,\n           include.null,\n           start.years,\n           H.select,\n           n_cores,\n           n_sims,\n           n_age0_covs,\n           n_mor_covs,\n           custom.settings,\n           mcmc.algorithm,\n           nuts.inputs,\n           run_year,\n           run_month)\n# 2021-07-06:  323 minutes\n",
    "created" : 1627498641646.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "54|46|90|0|\n91|46|127|0|\n",
    "hash" : "2975045251",
    "id" : "4783FEBF",
    "lastKnownWriteTime" : 1627505548,
    "last_content_update" : 1627505548731,
    "path" : "~/Thesis/pwsher_baymodsel/src/model_run_mortality_effects.R",
    "project_path" : "src/model_run_mortality_effects.R",
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}