{
    "collab_server" : "",
    "contents" : "# model_run_recruit_effects.r\n# Created by John Trochta\n# Date started:  12/01/2016\n# Summary:\n# This script runs the Bayesian ASA model (BASA) for PWS using different\n# covariates and extracts the output. Each section calls run_models to perform\n# the following steps:\n#     1) Compiles and extracts each version of BASA from bin directory.\n#     2) Runs parallel processing where each covariate is individually turned on\n#        within BASA. Iterative reweighting of eff. sample sizes for age comps\n#        is done before running NUTS.\n#     3) Runs 3 MCMC chains with NUTS for each BASA-one covariate model.\n#        Importantly, parallel processsing is setup so that the max number of\n#        processors running at any time is n_cores x nuts.inputs$reps.\n#     4) Stores output files of each BASA model in their respective folders\n#        (following naming of hypothesis_names) and summary files of NUTS runs\n#        (i.e. parameter posterior quantiles & convergence diagnostics) within\n#        NUTS_chain_diagnostics\n\nlibrary(here)\nsetwd(here::here(\"src\"))\nlibrary(data.table)\nsource(file=\"run_models.R\")\n\n### Specifications for all model sets\nrun_year=\"2021\"\nrun_month=\"07\"\nhypothesis_names <- c(\"1989 regime shift\",\n                      \"Hatchery-released juvenile pink salmon\",\n                      \"GOA walleye pollock age 1\",\n                      'Summer NPGO',\n                      'Summer PDO',\n                      'Age 0 scale growth (lagged 1 year)',\n                      'Freshwater discharge',\n                      \"PWS Avg. Zooplankton density '81-'99\")\nh.block <- c(1:8) # Indices of above hypotheses in columns (matching length of this vector) of covariate matrix in PWS_ASA(covariate).ctl\nstart.years <- c(rep(1980,7),1981)\ninclude.null=FALSE\nn_run_types=length(hypothesis_names)\nn_age0_covs=8\nn_mor_covs=14\n\nn_cores <- 3\nmcmc.algorithm=\"NUTS\"\nnuts.inputs=data.frame(reps=3,iter=3000,adapt_delta=0.925,warm_up=500,nuts.mode=1)\n\n#### 2020_04_all fixed age0 effects ####\n# Run with\n#  - all covariates as fixed effects from 1980-2017\n#  - rec devs are centered around estimated mean & estimated sigma\n#  - mean mortality is fixed at 0.25 (line 461 in PWS_ASA.TPL)\n\nH.select <- list(single=1:length(hypothesis_names))\ncustom.settings <- list(n_run_types=n_run_types,\n                        R.or.M=rep('R',n_run_types),\n                        series_start_yr=2000,\n                        estimate.1993.mortality=rep(1,length(hypothesis_names)),\n                        estimate.mean.mortality=rep(0,length(hypothesis_names)),\n                        mean.mortality=c(rep(0.3,length(hypothesis_names))),\n                        h.block=h.block,\n                        sim_cov=0,\n                        block.on=NULL,\n                        run_ID='2021_07_all fixed age0 effects',\n                        base.M=\"PWS_ASA_all fixed effects _ pen rec\")\n\nrun_models(hypothesis_names,\n           include.null,\n           start.years,\n           H.select,\n           n_cores,\n           n_sims,\n           n_age0_covs,\n           n_mor_covs,\n           custom.settings,\n           mcmc.algorithm,\n           nuts.inputs,\n           run_year,\n           run_month)\n\n# 2021-07-14: 183 mins.  \n\n\n#### 2020_04_all fixed age0 effects & start from 1994 ####\n# Run with\n#  - all covariates as fixed effects\n#  - only 1994-2017 of covariates are incorporated\n#  - rec devs are centered around estimated mean & estimated sigma\n#  - mean mortality is fixed at 0.25 (line 461 in PWS_ASA.TPL)\n\nH.select <- list(single=1:7)\ncustom.settings <- list(n_run_types=n_run_types,\n                        R.or.M=rep('R',n_run_types),\n                        series_start_yr=1981,\n                        estimate.1993.mortality=rep(1,length(hypothesis_names)),\n                        estimate.mean.mortality=rep(0,length(hypothesis_names)),\n                        mean.mortality=c(rep(0.25,length(hypothesis_names))),\n                        h.block=h.block,\n                        sim_cov=0,\n                        block.on=NULL,\n                        run_ID='2020_04_all fixed age0 effects _ start from 1994',\n                        base.M=\"PWS_ASA_all fixed effects & pen rec _ start from 1994\")\n\nstart_time <- proc.time()\nrun_models(hypothesis_names,\n           include.null,\n           start.years,\n           H.select,\n           n_cores,\n           n_sims,\n           n_age0_covs,\n           n_mor_covs,\n           custom.settings,\n           mcmc.algorithm,\n           nuts.inputs,\n           run_year,\n           run_month)\nprint(proc.time() - start_time)\n# 2020-01-25:  120 mins.\n\n\n#### 2021_07_latent age0 effects & year specific SE ####\n# Run with\n#  - select covariates are latent variables\n#  - rec devs are centered around estimated mean & estimated sigma\n#  - mean mortality is fixed at 0.25 (line 461 in PWS_ASA.TPL)\n#    This version ensures estimated recruit devs for those years without obs do not impact mortality\n\nrun_year=\"2021\"\nrun_month=\"07\"\n\nH.select <- list(single=2:7)\ncustom.settings <- list(n_run_types=n_run_types,\n                        R.or.M=rep('R',n_run_types),\n                        series_start_yr=1980,\n                        estimate.1993.mortality=rep(1,length(hypothesis_names)),\n                        estimate.mean.mortality=rep(0,length(hypothesis_names)),\n                        mean.mortality=c(rep(0.25,length(hypothesis_names))),\n                        h.block=h.block,\n                        sim_cov=0,\n                        block.on=NULL,\n                        run_ID=paste0(run_year,'_',run_month,'_','latent age0 effects _ year specific SE'),\n                        base.M=\"PWS_ASA_latent vars for age0 _ year specific SE\")\n\nnuts.inputs=data.frame(reps=3,iter=3000,adapt_delta=0.95,warm_up=500,nuts.mode=1)\n\nstart_time <- proc.time()\nrun_models(hypothesis_names,\n           include.null,\n           start.years,\n           H.select,\n           n_cores,\n           n_sims,\n           n_age0_covs,\n           n_mor_covs,\n           custom.settings,\n           mcmc.algorithm,\n           nuts.inputs,\n           run_year,\n           run_month)\nprint(proc.time() - start_time)\n\n# 07/09/2021:  64.9 mins\n\n\n#### 2021_07_all fixed age0 effects_low sigmaR ####\nH.select <- list(single=1:length(hypothesis_names))\ninclude.null=FALSE\nn_run_types=length(hypothesis_names)\nn_age0_covs=8\nn_mor_covs=14\ncustom.settings <- list(n_run_types=n_run_types,\n                        R.or.M=rep('R',n_run_types),\n                        series_start_yr=2000,\n                        estimate.1993.mortality=rep(1,length(hypothesis_names)),\n                        estimate.mean.mortality=rep(0,length(hypothesis_names)),\n                        mean.mortality=c(rep(0.3,length(hypothesis_names))),\n                        h.block=h.block,\n                        sim_cov=0,\n                        block.on=NULL,\n                        run_ID='2021_07_all fixed age0 effects_low sigmaR',\n                        base.M=\"PWS_ASA_all fixed effects _ pen rec_low sigmaR\")\n\nrun_models(hypothesis_names,\n           include.null,\n           start.years,\n           H.select,\n           n_cores,\n           n_sims,\n           n_age0_covs,\n           n_mor_covs,\n           custom.settings,\n           mcmc.algorithm,\n           nuts.inputs,\n           run_year,\n           run_month)\n# 07/14/2021 Run: ### minutes\n\n\n",
    "created" : 1627502981272.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "46|36|81|0|\n82|54|119|0|\n",
    "hash" : "2458483514",
    "id" : "C282A8B4",
    "lastKnownWriteTime" : 1627503807,
    "last_content_update" : 1627505780148,
    "path" : "~/Thesis/pwsher_baymodsel/src/model_run_recruit_effects.R",
    "project_path" : "src/model_run_recruit_effects.R",
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}